## generalization of CPo model with shifting real rate endpoint
rho.g <- 0.99
rho.x <- 0.95
lam.pistar <- -0.01
lam.rstar <- -.002
lam.c <- -0.01
lam.g <- -0.01

N <- 600
B.pistar <- numeric(N)
B.c <- numeric(N) #
B.rstar <- numeric(N)
B.g <- numeric(N) #
B.x <- numeric(N)
B.pistar[1] <- -1
B.c <- -1
D[1] <- -1
E[1] <- 0

for (n in 2:N) {
    B[n] <- -1 + B[n-1]
    C[n] <- -1 + C[n-1]
    D[n] <- -1 + D[n-1]*rho.g
    E[n] <- E[n-1]*rho.x - B[n-1]*lam.tau.x - C[n-1]*lam.alpha.x - D[n-1]*lam.g.x
}

Bf <- B[1:(N-1)] - B[2:N]
Cf <- C[1:(N-1)] - C[2:N]
Df <- D[1:(N-1)] - D[2:N]
Ef <- E[1:(N-1)] - E[2:N]

cols <- c("black", "green", "blue", "red")
plot(Bf, ylab="Forward rate loadings", xlab="Horizon", col=cols[1], ylim=range(c(0, Bf, Cf, Df, Ef)), type="l", lwd=2, lty=1)
lines(Cf, col=cols[2], lwd=2, lty=2)
lines(Df, col=cols[3], lwd=2, lty=3)
lines(Ef, col=cols[4], lwd=2, lty=3)
## abline(h=0, lty=2)
legend("bottomright", c("tau=pi*", "alpha=r*", "g=EH slope", "x=RP"), col=cols, bg="white", lwd=c(2,2,2,2), lty=c(1,2,3,3), cex=0.8)

