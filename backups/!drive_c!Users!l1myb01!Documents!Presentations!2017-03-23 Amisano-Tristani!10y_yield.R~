## for discussion of Amisano-Tristani

rm(list=ls())
source("fns.R")
#graphics.off()

df <- loadData()
df <- subset(df, yyyymm<=200903)
cat("Date range:", range(df$yyyymm), "\n")

## slope regimes
df$slope <- df$y10 - df$y0.25
library(MSwM)
mod <- lm(slope ~ 1, df)
summary(mod)
set.seed(616)
p <- 1
msmod <- msmFit(mod, k=2, p=p, sw=rep(TRUE, 2+p))

print(summary(msmod))
## plotProb(msmod)

i <- 2
T <- nrow(df)
dates <- df$date[(p+1):T]
filtered <- msmod@Fit@filtProb[1:(T-p),i]
smoothed <- msmod@Fit@smoProb[1:(T-p),i]
dev.new()
## pdf("regimes.pdf", width=7, height=5, pointsize=10)
par(mar=c(3,4,1,1))
cols <- c("blue", "darkgreen")
lwds <- c(2,2,2,2)
plot(dates, filtered, type="l", col=cols[1], lwd=lwds[1], xlab="", ylab="Probability", main="", xaxs="i")
plotRecessions(par("usr")[3:4])
lines(dates, filtered, col=cols[1], lwd=lwds[1])
lines(dates, smoothed, col=cols[2], lwd=lwds[2])
## legend("topright", c("filtered", "smoothed"), col=cols, lwd=lwds, bg="white")
## dev.off()


