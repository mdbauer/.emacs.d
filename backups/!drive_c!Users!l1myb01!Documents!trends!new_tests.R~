## analyze role of trends in quarterly data
## includes Mueller-Watson unit root statistics

rm(list=ls())
require(sandwich) # NeweyWest()
source("R/trends_fns.r")
source("R/ur_tests.R")
source("R/mueller-watson-fns.R")

df <- loadData()

## Table 1: regressions of y10 on pi* and r*
varnames <- c("pistar.ptr", "rstar.mean")
specs <- rbind(c(1,0),
               c(1,1))
yieldvars <- c("y5", "y10", "f510")

q <- 8
cat("focusing on periodicities longer than", 2*nrow(df)/q/4, "years\n")
## initially I used q=12 like MW

getStats <- function(z, nvar=1) {
    rho <- acf(z, lag.max=1, plot=FALSE)$acf[2]
    rval <- sprintf("%4.2f", rho)
    rval <- c(rval, sprintf("%4.1f", log(0.5)/log(abs(rho))))
    rval <- c(rval, myERS(z, nvar), myKPSS(z, nvar))
    rval <- c(rval, sprintf("%4.2f", c(lfur(z, q)$pval, lfst(z, q)$pval)))
    tmp <- estFracD(z, q, Nsim=5000)
    rval <- c(rval, tmp$mle, tmp$ci[1], tmp$ci[2])
    return(rval)
}

tbl <- data.frame(matrix(NA, length(yieldvars)*3, 10))
names(tbl) <- c("Series", "ACF(1)", "Half-life", "DFGLS", "KPPS", "LFUR", "LFST", "d: MLE", "LB", "UB")
X <- data.matrix(df[varnames])
row <- 1
for (i in seq_along(yieldvars)) {
    depvar <- yieldvars[i]
    ## yield
    z <- df[[depvar]]
    tbl[row, 1] <- depvar
    tbl[row, -1] <- getStats(z)
    row <- row+1
    ## yield detrended, unit coefficients
    for (j in 1:2) {
        b <- specs[j,]
        ind <- b==1
        z <- df[[depvar]] - X %*% b
        tbl[row, 1] <- paste(yieldvars[i], "-", paste(varnames[ind], collapse=" - "))
        tbl[row, -1] <- getStats(z)
        ## print(tbl[1:row,])
        row <- row+1
    }
}

rownames(tbl) <- tbl[,1]
tbl <- tbl[,-1]
tbl <- tbl[,-(3:4)]
print(tbl)
