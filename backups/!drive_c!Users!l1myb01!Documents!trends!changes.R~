## regressions of changes in yields on changes in trends

rm(list=ls())
require(sandwich) # NeweyWest()
require(xtable) # xtable()
source("R/trends_fns.R")
df <- loadData()
df$istar <- df$pistar.ptr + df$rstar.mean

yieldvar <- "f510"
freqs <- c(1,4,8,12,16,20,30,40)

## univariate analysis
trendvar <- "pistar.ptr"
nms <- c("const", "const SE",
         "trend", "trend SE",
         "R^2", "correlation")
tbl <- matrix(NA, length(nms), length(freqs))
rownames(tbl) <- nms
colnames(tbl) <- freqs
for (i in seq_along(freqs)) {
    h <- freqs[i]
    df$y <- c(rep(NA, h), diff(df[[yieldvar]], h))
    df$x <- c(rep(NA, h), diff(df[[trendvar]], h))
    mod <- lm(y ~ x, df)
    V <- NeweyWest(mod, lag=ceiling(1.5*h), prewhite=FALSE)
    tbl[c(1,3), i] <- mod$coef
    tbl[c(2,4), i] <- sqrt(diag(V))
    tbl[5, i] <- summary(mod)$r.squared
    tbl[6, i] <- cor(df$x, df$y, use="complete.obs")
}
print(round(tbl, 3))

## multivariate analysis
nms <- c("const", "const SE",
         "pistar", "pistar SE",
         "rstar", "rstar SE",
         "R^2")
tbl <- matrix(NA, length(nms), length(freqs))
rownames(tbl) <- nms
colnames(tbl) <- freqs
for (i in seq_along(freqs)) {
    h <- freqs[i]
    df$dy <- c(rep(NA, h), diff(df[[yieldvar]], h))
    df$dpistar <- c(rep(NA, h), diff(df$pistar.ptr, h))
    df$drstar <- c(rep(NA, h), diff(df$rstar.mean, h))
    mod <- lm(dy ~ dpistar + drstar, df)
    V <- NeweyWest(mod, lag=ceiling(1.5*h), prewhite=FALSE)
    tbl[c(1, 3, 5), i] <- mod$coef
    tbl[c(2, 4, 6), i] <- sqrt(diag(V))
    tbl[7, i] <- summary(mod)$r.squared
}
print(round(tbl, 3))


