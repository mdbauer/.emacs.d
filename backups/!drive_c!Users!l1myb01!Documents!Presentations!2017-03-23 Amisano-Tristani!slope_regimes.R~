## for discussion of Amisano-Tristani

rm(list=ls())
source("fns.R")
graphics.off()

df <- loadData()
df <- subset(df, yyyymm<=200903)
cat("Date range:", range(df$yyyymm), "\n")

## slope regimes
df$slope <- df$y10 - df$y0.25
library(MSwM)
mod <- lm(slope ~ 1, df)
summary(mod)
set.seed(616)
msmod <- msmFit(mod, k=2, sw=c(TRUE,TRUE))

print(summary(msmod))
## plotProb(msmod)

head(msmod@Fit@filtProb)
T <- 150
cbind(msmod@Fit@filtProb[,1], msmod@Fit@smoProb[1:T,1])

i <- 1
## dev.new()
pdf("regimes.pdf", width=7, height=5, pointsize=10)
par(mar=c(3,4,1,1))
cols <- c("blue", "darkgreen")
lwds <- c(2,2,2,2)
plot(df$date, msmod@Fit@filtProb[,i], type="l", col=cols[1], lwd=lwds[1], xlab="", ylab="Probability", main="", xaxs="i")
plotRecessions(par("usr")[3:4])
lines(df$date, msmod@Fit@filtProb[,i], col=cols[1], lwd=lwds[1])
lines(df$date, msmod@Fit@smoProb[1:T,i], col=cols[2], lwd=lwds[2])
## legend("topright", c("filtered", "smoothed"), col=cols, lwd=lwds, bg="white")
dev.off()


