## look at factor structure of detrended yields

rm(list=ls())
source("R/trends_fns.r")

df <- loadData()
cat("Date range:", range(df$yyyymm), "\n")
T <- nrow(df)

## yields and PCs
N <- 10 # goal maturity for YTP
## -> need returns for bonds with maturity of 2 to N periods
## -> maturity of longest predictor yield is N-1
yield.cols <- attr(df, "yield.cols")[3:(2+N)]
mats <- (1:N)
Y <- data.matrix(df[,yield.cols])
Ypred <- data.matrix(df[,yield.cols[1:(N-1)]])
W <- eigen(cov(Ypred))$vectors[,1:3]
P <- Ypred %*% W
